<div class="container phase-page">
  <div class="row">
    <div class="col-xs-12 header">
      <%= link_to root_path do %>
        <span class='glyphicon glyphicon-arrow-left'></span> Volver al inicio
      <% end %>
      <% if current_user.is_admin? %>
      <div class="actions">
        <%= link_to edit_phase_path(@phase), class: "btn btn-success btn-xs pull-right"  do %>
        <span class='glyphicon glyphicon-pencil'></span> &nbsp;Editar Fase
        <% end %>
      </div>
      <% end %>
    </div>
    <div class="clearfix"></div>
    <div class="col-md-6 col-md-offset-3">
      <%= quote %>
    </div>
  </div>
  <% if current_user.is_admin? %>
    <div class="row">
      <div class="col-sm-12 text-center">
        <%= link_to "<span class='glyphicon glyphicon-plus'></span> &nbsp;Nuevo Curso".html_safe, new_course_path, class: "btn btn-success new-course-btn" %>
      </div>
    </div>
  <% end %>
  <% @courses.each_with_index do |course, i| %>
    <div class="row">
      <div class="col-sm-12" id="course_<%= course.id %>" data-sortable="true" data-resource-id="<%= course.id %>">
        <div class="course">
          <% if current_user.is_admin? %>
          <div class="actions">
            <% if !course.published %><span class="glyphicon glyphicon-exclamation-sign action action-warn" data-toggle="tooltip" data-placement="bottom" title="No publicado"></span><% end %>
            <%= link_to "<span class='glyphicon glyphicon-pencil action action-edit'></span>".html_safe, edit_course_path(course) %>
            <a href="#"><span class='glyphicon glyphicon-remove action action-remove'></span></a>
          </div>
          <% end %>
          <div class="title"><%= course.name %></div>
          <%= progress_bar(progress: current_user.progress(course),color: @phase.color) %>
          <p><%= course.description %></p>
          <div class="row info">
            <div class="col-xs-4 info-item">
              <span class="info-item-value"><%= course.challenges.published.count %></span>
              <span class="info-item-label"><%= "Reto".pluralize(course.challenges.published.count) %></span>
            </div>
            <div class="col-xs-4 info-item">
              <span class="info-item-value"><%= course.resources.published.count %></span>
              <span class="info-item-label"><%= "Recurso".pluralize(course.resources.published.count) %></span>
            </div>
            <div class="col-xs-4 info-item">
              <span class="info-item-value"><%= course.projects.published.count %></span>
              <span class="info-item-label"><%= "Proyecto".pluralize(course.projects.published.count) %></span>
            </div>
          </div>
          <div class="text-center"><%= link_to "Entrar", course, class: "btn btn-primary btn-block" %></div>
        </div>
      </div>
    </div>
    <% if i != @courses.size - 1 %>
      <div class="course-divider"><div></div></div>
    <% end %>
  <% end %>
</div>

<%= render 'courses/profile_questions' unless current_user.active? %>

<% if current_user.is_admin? %>
  <script>
    (function() {
      sortable_courses =  new SortableView({el: ".phase-page",resource:"courses"})
      $(document).on("page:before-change", function() {
        sortable_courses.remove();
      });
    })()
  </script>
<% end %>
